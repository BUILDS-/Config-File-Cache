#!/bin/bash

for entry in $(cat ~/Mail/.notmuch/hooks/.spam.db); do
    notmuch tag -untagged -unread +spam -- tag:new and from:"$entry"
done;

for entry in $(cat ~/Mail/.notmuch/hooks/.local.db); do
    notmuch tag -untagged +local -- tag:new and from:"$entry"
done;

for entry in $(cat ~/Mail/.notmuch/hooks/.rss.db); do
    notmuch tag -untagged +rss -- tag:new and from:"$entry"
done;

run=0
for entry in $(cat ~/Mail/.notmuch/hooks/.tofrom.db); do
    line1=$line2
    line2=$entry
    if [ $run == 1 ]; then
        notmuch tag -untagged +"$line1" -- tag:new and to:"$line2"
        notmuch tag -untagged +"$line1" -- tag:new and cc:"$line2"
        notmuch tag -untagged +"$line1" -- tag:new and from:"$line2"
        run=0
    else
        run=1
    fi
done;

run=0
for entry in $(cat ~/Mail/.notmuch/hooks/.subject.db); do
    line1=$line2
    line2=$entry
    if [ $run == 1 ]; then
        notmuch tag -untagged +"$line1" -- tag:new and subject:"$line2"
        run=0
    else
        run=1
    fi
done;

notmuch tag -untagged +liberationtech -- tag:new and subject:'liberationtech' and not subject:'liberationtech-jobs'

for entry in $(cat ~/Mail/.notmuch/hooks/.sent.db); do 
    notmuch tag -untagged +sent -- tag:new and from:"$entry"
done;

# cleanup
notmuch tag -new -untagged +inbox -- tag:new and tag:untagged
notmuch tag -new -- tag:new

# pro mode
notmuch search --output=files tag:spam and tag:attachment | xargs rm -f
